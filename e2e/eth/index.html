<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="/dist/orbs-client-sdk-web.js"></script>
    <script>
        async function getWeb3() {
            await window.ethereum.enable();
            return new Web3(window.ethereum);
        }
        

        // window.start = async () => {
        //     await window.ethereum.enable();
        //     const web3 = new Web3(window.ethereum);
        //     const addr = (await web3.eth.getAccounts())[0];
        //     console.log(await web3.eth.personal.sign("0x6666", addr));
        //     console.log(await web3.eth.personal.sign("0x4343", addr));
        // };

    </script>
</head>
<body>
    <script>
        // window.start();
        class Signer {
            constructor(web3) {
                this.web3 = web3;
            }

            async getPublicKey() {
                return (await this.web3.eth.getAccounts())[0];
            }

            async signEd25519(data) {
                const signature = await this.web3.eth.personal.sign(Orbs.encodeHex(data), await this.getPublicKey());
                console.log(signature);
                // ethereum returns 65 bytes, last byte is recovery value
                // https://ethereum.stackexchange.com/questions/51673/what-is-the-size-of-the-web3-eth-sign-result
                return Orbs.decodeHex(signature).slice(0, 64); 
            }

            // uint8ArrayToHexString(arr) {
            //     return Array.prototype.map.call(arr, (x) => ("00" + x.toString(16)).slice(-2)).join("");
            // }

        }
        
        (async () => {
            const web3 = await getWeb3();
            const signer = new Signer(web3);

            console.log(await signer.getPublicKey());
            console.log("ECDSA", await signer.signEd25519(new Uint8Array([1, 2, 3])));

            const account = await Orbs.createAccount();
            const localSigner = new Orbs.LocalSigner(account);

            console.log("ed25519", await localSigner.signEd25519(new Uint8Array([1, 2, 3])));

            const client = new Orbs.Client("http://validator.orbs.com/vchains/5100", 5100, "TEST_NET", signer);
            const [tx, txId] = await client.createTransaction( "BenchmarkToken", "transfer", [Orbs.argUint64(10)]);
            console.log(txId);~
            console.log(tx);
        })();
        
    </script>

</body>
</html>